---
title: "Public Finances"
author: Luis Francisco Gomez Lopez
date: 2023-10-01 18:34:20
output:
  beamer_presentation:
    colortheme: dolphin
    fonttheme: structurebold
    theme: AnnArbor
  ioslides_presentation: default
  slidy_presentation: default
bibliography: intro_econ.bib
link-citations: yes
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{xcolor}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo      = FALSE, 
                      warning   = FALSE, 
                      message   = FALSE,
                      fig.align = "center")
```

```{r}
library(DiagrammeR)
library(tidyverse)
library(readxl)
library(knitr)
library(kableExtra)
library(tidyquant)
library(tufte)
library(OECD)
library(treemapify)
```

# Contents

- Please Read Me
- Purpose
- Economic functions of government
- Colombian public sector
- Revenues: taxes 
- Expenditures
- Acknowledgments
- References

# Please Read Me

- Check the message __Welcome greeting__ published in the News Bulletin Board.

- Dear student please edit your profile uploading a photo where your face is clearly visible.

- The purpose of the virtual meetings is to answer questions and not to make a summary of the study material.

- This presentation is based on [@cardenas_introduccion_2020, Chapter 6]

# Purpose

Explain the role of the State in the economy

# Economic functions of government

- What are the economic functions of government? [@council_for_economic_education_focus_2010, p 45-54]

    + **Maintain the Legal and Social Framework**
    
        + Define and enforce property rights
        + Establish a monetary system
        
    + **Maintain competition in the marketplace**
    
        + Create and enforce antitrust laws
        + Regulate natural monopolies
    
    + **Provide public goods and services**
    
        + Some goods and services are not provided by the market in the quantities desired by society
        
# Economic functions of government

- What are the economic functions of government? [@council_for_economic_education_focus_2010, p 45-54]

    + **Correct for externalities**
    
        + Reduce negative externalities 
        + Encourage increased production of goods and services that have positive externalities
        
    + **Stabilize the economy**
    
        + Reduce unemployment and inflation
        + Promote economic growth
        
    + **Redistribute income**
    
        + Targeting public spending
        + Collect taxes
        
# Colombian public sector

- Division based on [@international_monetary_fund_government_2014, fig 2.3] and [@ciefp_clasificacion_2019] using the **Código Único Institucional - CUIN**

```{r out.width="160%"}
grViz("
digraph boxes_and_circles {

  graph [rankdir = TB]

  node [shape = circle, color = '#2C3E50']
 
  'Sector Público';

  node [shape = oval, color = '#E31A1C']

  'Empresas\nno\nfinancieras';
  'Empresas\nfinancieras';
  'Gobierno\nGeneral'
  
  node [shape = rectangle, color = '#18BC9C']
  
  'Sociedad\nno\nFinanciera\nPública';
  'Banco\nCentral';
  'Otras\nSociedades\nde\nDepósito';
  'Otros\nIntermediarios\nFinancieros';
  'Otros\nAuxiliares\nFinancieros';
  'Compañías\nde\nSeguros\ny\nCajas\nde\nPensiones\ny\nCesantías';
  'Gobierno\nCentral';
  'Gobierno\nDepartamental';
  'Gobierno\nMunicipal';
  'Seguridad\nSocial';
  
  'Sector Público' -> 'Empresas\nno\nfinancieras';
  'Sector Público' -> 'Empresas\nfinancieras';
  'Sector Público' -> 'Gobierno\nGeneral';

  'Empresas\nno\nfinancieras' -> 'Sociedad\nno\nFinanciera\nPública';
  'Empresas\nfinancieras' -> 'Banco\nCentral';
  'Empresas\nfinancieras' -> 'Otras\nSociedades\nde\nDepósito';
  'Empresas\nfinancieras' -> 'Otros\nIntermediarios\nFinancieros';
  'Empresas\nfinancieras' -> 'Otros\nAuxiliares\nFinancieros';
  'Empresas\nfinancieras' -> 'Compañías\nde\nSeguros\ny\nCajas\nde\nPensiones\ny\nCesantías';
  'Gobierno\nGeneral' -> 'Gobierno\nCentral';
  'Gobierno\nGeneral' -> 'Gobierno\nDepartamental';
  'Gobierno\nGeneral' -> 'Gobierno\nMunicipal';
  'Gobierno\nGeneral' -> 'Seguridad\nSocial';
}
")
```
        
# Colombian public sector

- Division based on how information is reported in [@mhcp_marco_2021]

```{r out.width="160%"}
grViz("
digraph boxes_and_circles {

  graph [rankdir = LR]

  node [shape = circle, color = '#2C3E50']
 
  'Sector Público\nConsolidado\n(SPC)';

  node [shape = oval, color = '#E31A1C']

  'Sector Público\nFinanciero\n(SPF)';
  'Sector Público\nno Financiero\n(SPNF)';
  
  node [shape = oval, color = '#18BC9C']
  
  'Banco de\nla República';
  'Fogafín';
  'Gobierno\nGeneral (GG)';
  'Empresas\nPúblicas';
  'Sector Público\nno Modelado\n(SPNM)';
  
  node [shape = oval, color = '#CCBE93']
  
  'Gobierno\nCentral (GC)';
  'Regionales y\nLocales';
  'Seguridad\nSocial';
  'Nivel\nNacional';
  'Nivel\nLocal';
  
  node [shape = oval, color = '#FF7F00']
  
  'Gobierno\nNacional\nCentral (GNC)';
  'Resto del\nNivel Central';
  
  'Sector Público\nConsolidado\n(SPC)' -> 'Sector Público\nFinanciero\n(SPF)';
  'Sector Público\nConsolidado\n(SPC)' -> 'Sector Público\nno Financiero\n(SPNF)';
  
  'Sector Público\nFinanciero\n(SPF)' -> 'Banco de\nla República';
  'Sector Público\nFinanciero\n(SPF)' -> 'Fogafín';
  'Sector Público\nno Financiero\n(SPNF)' -> 'Gobierno\nGeneral (GG)';
  'Sector Público\nno Financiero\n(SPNF)' -> 'Empresas\nPúblicas';
  'Sector Público\nno Financiero\n(SPNF)' -> 'Sector Público\nno Modelado\n(SPNM)';
  
  'Gobierno\nGeneral (GG)' -> 'Gobierno\nCentral (GC)';
  'Gobierno\nGeneral (GG)' -> 'Regionales y\nLocales';
  'Gobierno\nGeneral (GG)' -> 'Seguridad\nSocial';
  'Empresas\nPúblicas' ->'Nivel\nNacional';
  'Empresas\nPúblicas' -> 'Nivel\nLocal';
  
  'Gobierno\nCentral (GC)' -> 'Gobierno\nNacional\nCentral (GNC)';
  'Gobierno\nCentral (GC)' -> 'Resto del\nNivel Central';
  
}
")
```

# Colombian public sector

- Central National Government (Gobierno Nacional Central (GNC)) Fiscal Balance 

    + The fiscal balance is the difference between the central national government’s revenues and its expenditures
    
    + It shows the extent to which expenditure in a given year is financed by the revenues collected in that year [@oecd_government_2021, p 68]
    
        + When the central national government spends more than it collects as revenues, it has a **fiscal deficit**
        
        + When the central national government spends less than it collects as revenues, it has a **fiscal surplus**
        
# Colombian public sector

```{r}
# Data
# https://www.minhacienda.gov.co > Entidades Financieras 
# > Balance Gobierno Nacional Central
# > Balance Gobierno Nacional Central 1994-2021
cng_fb <- read_excel(path = "000_data/006_balance_gobierno_nacional_central_1994-2021.xlsx", 
                     sheet = 2, 
                     range = "B5:AD100") %>%
  rename(Concepto = "CONCEPTO") %>% 
  slice(-c(1:2,4,33,35,50,52,54,71,73,75,77,79,81,83,94)) %>% 
  select(Concepto, `2021`)

cng_fb_table <- cng_fb %>% 
  slice(2:5, 8:26,29)

cng_fb_table_footnote <- cng_fb_table

names(cng_fb_table_footnote)[2] <-  paste0(names(cng_fb_table_footnote)[2],
                                           footnote_marker_alphabet(1, "latex"))

cng_fb_table_footnote %>% 
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 2, linesep = "") %>%
  kable_styling(font_size = 5.4) %>%
  add_indent(positions = c(2,21), level_of_indent = 2) %>%
  add_indent(positions = 3, level_of_indent = 3) %>% 
  add_indent(positions = c(4:20,22:24), level_of_indent = 5) %>%
  row_spec(row = 0, bold = TRUE) %>% 
  row_spec(row = 1, bold = TRUE, background = unname(palette_light()[4])) %>% 
  row_spec(row = c(2,21), bold = TRUE, background = unname(palette_light()[2])) %>% 
  row_spec(row = 3, bold = TRUE, background = unname(palette_light()[3])) %>% 
  footnote(general       = c('Source: Ministerio de Hacienda y Crédito Público - Balance Gobierno Nacional Central', 'Last update: 2022-06-15'),
           general_title = "",
           alphabet = '%PIB - Cierre fiscal',
           threeparttable = TRUE)

```

# Colombian public sector

```{r}
cng_fb_table <- cng_fb %>% 
  slice(1:3, 24, 30:44)

cng_fb_table_footnote <- cng_fb_table

names(cng_fb_table_footnote)[2] <-  paste0(names(cng_fb_table_footnote)[2],
                                           footnote_marker_alphabet(1, "latex"))

cng_fb_table_footnote %>% 
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 2, linesep = "") %>%
  kable_styling(font_size = 6) %>%  
  add_indent(positions = c(2, 5:6), level_of_indent = 2) %>%
  add_indent(positions = c(3:4), level_of_indent = 3) %>%
  add_indent(positions = c(7:8, 16:17), level_of_indent = 5) %>%
  add_indent(positions = c(9:15, 18:19), level_of_indent = 7) %>%
  row_spec(row = 0, bold = TRUE) %>% 
  row_spec(row = 1, background = unname(palette_light()[4]), bold = TRUE) %>% 
  row_spec(row = c(2, 5:6), bold = TRUE) %>%
  row_spec(row = 3, background = unname(palette_light()[3])) %>% 
  footnote(general       = c('Source: Ministerio de Hacienda y Crédito Público - Balance Gobierno Nacional Central', 'Last update: 2022-06-15'),
           general_title = "",
           alphabet = '%PIB - Cierre fiscal',
           threeparttable = TRUE)
```

# Colombian public sector

```{r}
cng_fb_table <- cng_fb %>% 
  slice(1:3, 24, 30:31, 45:55, 59:62)

cng_fb_table_footnote <- cng_fb_table

names(cng_fb_table_footnote)[2] <-  paste0(names(cng_fb_table_footnote)[2],
                                           footnote_marker_alphabet(1, "latex"))

cng_fb_table_footnote %>% 
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 2, linesep = "") %>%
  kable_styling(font_size = 5.5) %>%  
  add_indent(positions = c(2, 5:6, 8:9, 21), level_of_indent = 2) %>%
  add_indent(positions = c(3:4, 10, 14), level_of_indent = 3) %>%
  add_indent(positions = c(15:16, 20), level_of_indent = 4) %>%
  add_indent(positions = c(11:13, 17:19), level_of_indent = 5) %>%
  row_spec(row = 0, bold = TRUE) %>% 
  row_spec(row = c(1,7), background = unname(palette_light()[4]), bold = TRUE) %>% 
  row_spec(row = c(8:9, 21), background = unname(palette_light()[2]), bold = TRUE) %>%
  row_spec(row = c(3, 16), background = unname(palette_light()[3])) %>% 
  footnote(general       = c('Source: Ministerio de Hacienda y Crédito Público - Balance Gobierno Nacional Central', 'Last update: 2022-06-15'),
           general_title = "",
           alphabet = '%PIB - Cierre fiscal',
           threeparttable = TRUE)
```

# Colombian public sector

```{r}
cng_fb_table <- cng_fb %>% 
  slice(1:3, 24, 30:31, 45:48, 52, 62:69, 78:79)

cng_fb_table_footnote <- cng_fb_table

names(cng_fb_table_footnote)[2] <-  paste0(names(cng_fb_table_footnote)[2],
                                           footnote_marker_alphabet(1, "latex"))

cng_fb_table_footnote %>% 
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 2, linesep = "") %>%
  kable_styling(font_size = 5.5) %>% 
  add_indent(positions = c(2, 5:6, 8:9, 12, 14:17), level_of_indent = 2) %>%
  add_indent(positions = c(3:4, 10:11), level_of_indent = 3) %>%
  row_spec(row = 0, bold = TRUE)  %>% 
  row_spec(row = c(1,7,13,18:19), background = unname(palette_light()[4]), bold = TRUE) %>%
  row_spec(row = 20, background = unname(palette_light()[2]), bold = TRUE) %>%
  row_spec(row = 21, background = unname(palette_light()[11]), bold = TRUE) %>%
  row_spec(row = c(10, 16), background = unname(palette_light()[3]), bold = TRUE) %>%
  footnote(general       = c('Source: Ministerio de Hacienda y Crédito Público - Balance Gobierno Nacional Central', 'Last update: 2022-06-15'),
           general_title = "",
           alphabet = '%PIB - Cierre fiscal',
           threeparttable = TRUE)
```

# Colombian public sector

```{r}
cng_fb <- read_excel(path = "000_data/006_balance_gobierno_nacional_central_1994-2021.xlsx", 
                     # Cambiando la hoja para mostrar las cifras
                     # en miles de millones
                     sheet = 1, 
                     range = "B5:AD100") %>%
  rename(Concepto = "CONCEPTO") %>% 
  slice(-c(1:2,4,33,35,50,52,54,71,73,75,77,79,81,83,94)) %>% 
  select(Concepto, `2021`) %>%
  # Mostrando todas las cifras
  mutate(`2021` = (`2021`*10^9) %>% scales::number(big.mark = ",", 
                                                   accuracy = 0.1))

cng_fb_table <- cng_fb %>% 
  slice(1:3, 24, 30:31, 45:48, 52, 62:69, 78:79)

cng_fb_table_footnote <- cng_fb_table

names(cng_fb_table_footnote)[2] <-  paste0(names(cng_fb_table_footnote)[2],
                                           footnote_marker_alphabet(1, "latex"))

cng_fb_table_footnote %>% 
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 1, linesep = "") %>%
  kable_styling(font_size = 5.5) %>% 
  add_indent(positions = c(2, 5:6, 8:9, 12, 14:17), level_of_indent = 2) %>%
  add_indent(positions = c(3:4, 10:11), level_of_indent = 3) %>%
  row_spec(row = 0, bold = TRUE) %>% 
  row_spec(row = c(1,7,13,18:19), background = unname(palette_light()[4]), bold = TRUE) %>%
  row_spec(row = 20, background = unname(palette_light()[2]), bold = TRUE) %>%
  row_spec(row = 21, background = unname(palette_light()[11]), bold = TRUE) %>%
  row_spec(row = c(10, 16), background = unname(palette_light()[3]), bold = TRUE) %>%
  footnote(general       = c('Source: Ministerio de Hacienda y Crédito Público - Balance Gobierno Nacional Central', 'Last update: 2022-06-15'),
           general_title = "",
           alphabet = 'Pesos colombianos (COP)',
           threeparttable = TRUE)
```

# Revenues: taxes

- Useful resources

    + **Global Revenue Statistics Database**
    
        + **https://stats.oecd.org/** > Data by theme > Public Sector, Taxation and Market Regulation > Taxation > Global Revenue Statistics Database > Global Revenue Statistics Database
        
    + **Guía ciudadana a la tributación  y el gasto del Estado colombiano** [@observatorio_fiscal_de_la_universidad_javeriana_guiciudadana_2018]
    
        + **https://www.ofiscal.org/publicaciones** > guías ciudadanas
        
# Revenues: taxes

- **Taxes**: "compulsory unrequited payments to the general  government  or  to  a  supranational  authority" [@oecd_revenue_2020, p 319]

    + "Taxes are unrequited in the sense that benefits provided by government to taxpayers are not normally in proportion to their payments" [@oecd_revenue_2020, p 319]
    
    + "The term **tax** does not include fines, penalties and compulsory loans paid to government" [@oecd_revenue_2020, p 319]
    
    + Compulsory social security contributions and paid to general government are treated here as tax revenues [@oecd_revenue_2020, p 320]
    
# Revenues: taxes

- **Classification of Taxes by the OECD** [@oecd_revenue_2020, p 317-318]

    + 1000 Taxes on income, profits and capital gains (Impuestos sobre la renta, las utilidades y las ganancias de capital)
    + 2000 Social security contributions (Contribuciones a la seguridad social)
    + 3000 Taxes on payroll and workforce (Impuestos sobre la nómina y la fuerza de trabajo)
    + 4000 Taxes on property (Impuestos sobre la propiedad)
    + 5000 Taxes on goods and services (Impuestos sobre los bienes y servicios)
    + 6000 Other taxes (Otros impuestos)

# Revenues: taxes

- According to the Colombia's political constitution:

    + *"ARTICULO 363. El sistema tributario se funda en los principios de **equidad**, **eficiencia** y **progresividad**. ..."*
    
- **Equity**: Horizontal and vertical [@observatorio_fiscal_de_la_universidad_javeriana_guiciudadana_2018, p 8]

```{r out.width="30%", fig.show='hold', fig.align='center'}
knitr::include_graphics(c("_000_images/006_horizontal_equity.png",
                          "_000_images/006_vertical_equity.png"))
```

- **Efficiency**: taxes change the behavior of individuals and sometimes distort the economic activity by creating a deadweight loss. Therefore the idea is to have a tax system that minimize or mitigate these negative effects   

# Revenues: taxes

- **Progressivity** [@observatorio_fiscal_de_la_universidad_javeriana_guiciudadana_2018, p 11]

```{r out.width="39%", fig.align='center'}
knitr::include_graphics(c("_000_images/006_regressive_tax.png",
                          "_000_images/006_proportional_tax.png",
                          "_000_images/006_progressive_tax.png"))
```

# Revenues: taxes

```{r out.width="90%"}
# # Structure data set
# RS_GBL_structure <- get_data_structure(dataset = "RS_GBL")
# 
# # RS_GBL Global Revenue Statistics Database
# tax_pct_gdp_col_latin_oecd <- get_dataset(dataset = "RS_GBL",
#             start_time = 1990,
#             end_time = 2019,
#                           # Countries, regions, territories
#                           # Colombia, OECD - Average, Latin America and the Caribbean
#             filter = list(c("COL", "OAVG", "419"),
#                           # Government: NES Total
#                           c("NES"),
#                           # Tax: TOTALTAX Total Tax Revenue
#                           c("TOTALTAX"),
#                           # Variable: Tax revenue as % of GDP
#                           c("TAXGDP"))) %>%
#   left_join(y = as_tibble(RS_GBL_structure$COU),
#             by = c("COU" = "id"))
# 
# tax_pct_gdp_col_latin_oecd %>%
#   mutate(obsTime = as.integer(obsTime),
#          label = replace(label,
#                          list = label == "Latin America and the Caribbean",
#                          values = "Latin America and the Caribbean - Average")) %>%
#   ggplot(aes(x = obsTime, y = obsValue, group = label)) +
#   geom_line(aes(color = label))  +
#   scale_y_continuous(labels = scales::number_format(suffix = "%")) +
#   tidyquant::scale_color_tq()  +
#   expand_limits(y = 0) +
#   labs(x = NULL,
#        y = NULL,
#        color = NULL,
#        title    = "Total tax revenue as % of GDP",
#        subtitle = str_glue("Period: {min(tax_pct_gdp_col_latin_oecd$obsTime)}-{max(tax_pct_gdp_col_latin_oecd$obsTime)}
#                            Observation: Latin America and the Caribbean includes the following territories Antigua and Barbuda, Argentina, Bahamas, Barbados, Belize,
#                            Bolivia, Brazil, Chile, Colombia, Costa Rica, Cuba, Dominican Republic, Ecuador, El Salvador, Guatemala, Guyana, Honduras, Jamaica,
#                            Mexico, Nicaragua, Panama, Paraguay, Peru, Saint Lucia, Trinidad and Tobago, Uruguay"),
#        caption  = str_glue("Source: Global Revenue Statistics Database - OECD.Stat
#                              Last update date: 2021-09-24")) +
#   theme(panel.border    = element_rect(fill = NA, color = "black"),
#         plot.background   = element_rect(fill = "#f3fcfc"),
#         panel.background  = element_rect(fill = "#f3f7fc"),
#         legend.background = element_rect(fill = "#f3fcfc"),
#         legend.position   = "bottom",
#         plot.title        = element_text(face = "bold"),
#         axis.title        = element_text(face = "bold"),
#         legend.title      = element_text(face = "bold"),
#         axis.text         = element_text(face = "bold"))
```

- [@oecd_revenue_2022, p 2]

```{r out.width="90%"}
knitr::include_graphics(path = "000_data/006_tax_to_GDP_OECD_2021.png")
```

# Revenues: taxes

```{r out.width="90%"}
# # RS_GBL Global Revenue Statistics Database
# tax_struc_col_2019 <- get_dataset(dataset = "RS_GBL",
#             start_time = 2019,
#             end_time = 2019,
#                           # Countries, regions, territories
#                           # Colombia, OECD - Average, Latin America and the Caribbean
#             filter = list(c("COL"),
#                           # Government: NES Total
#                           c("NES"),
#                           # Tax: TOTALTAX Total Tax Revenue
#                           c("1110", "1210", "1300",
#                             "2000", "3000", "4000",
#                             "5111", "5112", "5113", "5120", "5130", "5200", "5300",
#                             "6000"),
#                           # Variable: Tax revenue as % of total taxation
#                           c("TAXPER"))) %>%
#   left_join(y = as_tibble(RS_GBL_structure$TAX),
#             by = c("TAX" = "id"))
# 
# # Consolidation
# tax_struc_col_consolidation <- tibble(TAX = tax_struc_col_2019$TAX,
#             label_consolidation = c("Impuesto sobre la renta de personas físicas",
#                                    "Impuesto sobre la renta de sociedades",
#                                    "Otros impuestos",
#                                    "Cotizaciones a la seguridad social",
#                                    "Otros impuestos",
#                                    "Impuestos sobre la propiedad",
#                                    "Impuesto sobre el valor añadido",
#                                    "Otros impuestos sobre bienes y servicios",
#                                    "Otros impuestos sobre bienes y servicios",
#                                    "Otros impuestos sobre bienes y servicios",
#                                    "Otros impuestos sobre bienes y servicios",
#                                    "Otros impuestos sobre bienes y servicios",
#                                    "Otros impuestos sobre bienes y servicios",
#                                    "Otros impuestos"))
# 
# tax_struc_col_2019 %>%
#   left_join(y = tax_struc_col_consolidation,
#             by = "TAX") %>%
#   group_by(COU, obsTime, label_consolidation) %>%
#   summarize(obsValue = sum(obsValue)) %>%
#   ungroup() %>%
#   mutate(label_pct = obsValue %>% scales::number(suffix = "%"),
#          label_consolidation = fct_reorder(label_consolidation,
#                                            obsValue) %>%
#            fct_rev()) %>%
#   ggplot(aes(area = obsValue,
#              fill = label_consolidation,
#              label = label_pct)) +
#   geom_treemap(color = "black") +
#   geom_treemap_text(place = "centre") +
#   scale_fill_tq() +
#   labs(fill = NULL,
#        title = str_glue("Tax revenue as % of total taxation in Colombia: {unique(tax_struc_col_2019$obsTime)}"),
#        caption = str_glue("Global Revenue Statistics Database - OECD.Stat
#                           Last update date: 2021-09-25")) +
#   theme(panel.border      = element_rect(fill = NA, color = "black"),
#         plot.background   = element_rect(fill = "#f3fcfc"),
#         panel.background  = element_rect(fill = "#f3f7fc"),
#         legend.background = element_rect(fill = "#f3fcfc"),
#         legend.position   = "bottom",
#         plot.title        = element_text(face = "bold"),
#         axis.title        = element_text(face = "bold"),
#         legend.title      = element_text(face = "bold"),
#         axis.text         = element_text(face = "bold"))
```

- [@oecd_revenue_2022, p 3]

```{r out.width="90%"}
knitr::include_graphics(path = "000_data/006_tax_structure_vs_oedc_average_2020.png")
```

# Expenditures

- Useful resources

    + **Portal de transparencia económica**
    
        + **https://www.pte.gov.co** > Consultas sobre la gestión de los recursos públicos > GASTOS DE LA NACIÓN
        
    + **Guía ciudadana a la tributación  y el gasto del Estado colombiano** [@observatorio_fiscal_de_la_universidad_javeriana_guiciudadana_2018]
    
        + **https://www.ofiscal.org/** > Gasto
        
# Expenditures

- **Presupuesto General de la Nación (PGN)**

    + It is the most important financial management instrument of fiscal policy
    
    + This instrument presents the government's proposed revenues and spending for a specific period
    
    + Every year the "Presupuesto General de la Nación (PGN)" is define for the next year
    
    + The "Presupuesto General de la Nación (PGN)" must be approved by the congress and sanctioned as a law by the president 
    
# Expenditures

```{r out.width="90%"}
# https://www.pte.gov.co  > Consultas sobre la gestión de los recursos públicos > GASTOS DE LA NACIÓN > Consultas: Consultas Personalizadas de Gastos
pgn_2022_what_spent <- read_excel("000_data/006_en_que_se_gasta_PTE.xlsx",
                                  sheet = 1, 
                                  range = "E1:M5") %>%
  select(TipoPresupuesto, ApropiacionInicial)

pgn_2022_what_spent %>% 
  slice(1:3) %>% 
  mutate(png_pct = ApropiacionInicial / pgn_2022_what_spent$ApropiacionInicial[4],
         png_pct_label = png_pct %>% scales::percent(accuracy = 0.01),
         TipoPresupuesto = str_to_title(TipoPresupuesto),
         TipoPresupuesto = TipoPresupuesto %>% fct_reorder(ApropiacionInicial) %>% 
           fct_rev()) %>%
  ggplot(aes(area = ApropiacionInicial,
             fill = TipoPresupuesto,
             label = png_pct_label)) +
  geom_treemap(color = "black") +
  geom_treemap_text(place = "centre") +
  scale_fill_tq() +
  labs(fill = NULL,
       title = str_glue("What is the nation's general budget spent on in 2022?"),
       subtitle = str_glue("Total national budget: {scales::number(pgn_2022_what_spent$ApropiacionInicial[4], big.mark = ',')} COP
                           Funcionamiento: {scales::number(pgn_2022_what_spent$ApropiacionInicial[1], big.mark = ',')} COP
                           Servicio De La Deuda: {scales::number(pgn_2022_what_spent$ApropiacionInicial[2], big.mark = ',')} COP,
                           Inversión: {scales::number(pgn_2022_what_spent$ApropiacionInicial[3], big.mark = ',')} COP"),
       caption = str_glue("Portal de transparencia económica - https://www.pte.gov.co/
                          Last update date: 2022-06-15")) +
  theme(panel.border      = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Expenditures

```{r}
pgn_2022_what_spent <- read_excel("000_data/006_en_que_se_gasta_PTE.xlsx",
                                  sheet = 1, 
                                  range = "E1:M5") %>%
  select(TipoPresupuesto, ApropiacionInicial)

pgn_2022_who_spends <- read_excel("000_data/006_quien_gasta_PTE.xlsx", 
                                  sheet = 1, 
                                  range = "A1:L193") %>%
  select(CodigoSector, NombreSector, ApropiacionInicial) %>% 
  slice(-1)

pgn_2022_who_spends_table <- pgn_2022_who_spends %>% 
  mutate(NombreSector = str_to_title(NombreSector)) %>% 
  group_by(CodigoSector, NombreSector) %>% 
  summarize(ApropiacionInicial = sum(ApropiacionInicial)) %>% 
  ungroup() %>% 
  mutate(png_pct = ApropiacionInicial / pgn_2022_what_spent$ApropiacionInicial[4]) %>% 
  arrange(desc(png_pct))
```

```{r out.width="90%"}
pgn_2022_who_spends_table %>% 
  mutate(NombreSector = case_when(
    ApropiacionInicial < pgn_2022_who_spends_table$ApropiacionInicial[11] ~ "Otros Sectores",
    TRUE ~ NombreSector)) %>% 
  group_by(NombreSector) %>% 
  summarize(across(ApropiacionInicial:png_pct, sum)) %>% 
  ungroup() %>%
  mutate(png_pct_label = str_glue("{scales::percent(png_pct, accuracy = 0.01)}
                                  {scales::number(ApropiacionInicial, scale = 1e-12, suffix = 'B')}"),
         NombreSector = NombreSector %>% fct_reorder(ApropiacionInicial) %>% 
           fct_rev()) %>% 
  ggplot(aes(area = ApropiacionInicial,
             fill = NombreSector,
             label = png_pct_label)) +
  geom_treemap(color = "black") +
  geom_treemap_text(place = "centre") +
  scale_fill_tq() +
  labs(fill = NULL,
       title = str_glue("Who spends nation's general budget spent on in 2022?"),
       subtitle = str_glue("Total national budget: {scales::number(pgn_2022_what_spent$ApropiacionInicial[4], big.mark = ',')} COP
                           Observation: B means billions in long scale (10^12)"),
       caption = str_glue("Portal de transparencia económica - https://www.pte.gov.co/
                          Last update date: 2022-06-15")) +
  theme(panel.border      = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Acknowledgments

- To my family that supports me

- To the taxpayers of Colombia and the __[UMNG students](https://www.umng.edu.co/estudiante)__ who pay my salary

- To the __[Business Science](https://www.business-science.io/)__ and __[R4DS Online Learning](https://www.rfordatasci.com/)__ communities where I learn __[R](https://www.r-project.org/about.html)__ 

- To the __[R Core Team](https://www.r-project.org/contributors.html)__, the creators of __[RStudio IDE](https://rstudio.com/products/rstudio/)__ and the authors and maintainers of the packages  __[DiagrammeR](https://CRAN.R-project.org/package=DiagrammeR)__,
__[tidyverse](https://CRAN.R-project.org/package=tidyverse)__, 
__[readxl](https://CRAN.R-project.org/package=readxl)__, 
__[knitr](https://CRAN.R-project.org/package=knitr)__, 
__[kableExtra](https://CRAN.R-project.org/package=kableExtra)__, 
__[tidyquant](https://CRAN.R-project.org/package=tidyquant)__, 
__[tufte](https://CRAN.R-project.org/package=tufte)__, 
__[OECD](https://CRAN.R-project.org/package=OECD)__, 
__[treemapify](https://CRAN.R-project.org/package=treemapify)__, and __[tinytex](https://CRAN.R-project.org/package=tinytex)__ for allowing me to access these tools without paying for a license

- To the __[Linux kernel community](https://www.kernel.org/category/about.html)__ for allowing me the possibility to use some __[Linux distributions](https://static.lwn.net/Distributions/)__ as my main __[OS](https://en.wikipedia.org/wiki/Operating_system)__ without paying for a license

# References {.allowframebreaks}