---
title: "Financial Market"
author: Luis Francisco Gomez Lopez
date: 2023-01-10 20:31:24
output:
  beamer_presentation:
    colortheme: dolphin
    fonttheme: structurebold
    theme: AnnArbor
  ioslides_presentation: default
  slidy_presentation: default
bibliography: intro_econ.bib
link-citations: yes
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{xcolor}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo      = FALSE, 
                      warning   = FALSE, 
                      message   = FALSE,
                      fig.align = "center")
```

```{r}
library(DiagrammeR)
library(tidyverse)
library(wbstats)
library(tidyquant)
library(ggrepel)
library(lubridate)
library(knitr)
library(kableExtra)
library(readxl)
```

# Contents

- Please Read Me
- Purpose
- Structure of the Colombian financial system
- Financial depth
- Principal instruments "Mercado no intermediado"
- Acknowledgments
- References

# Please Read Me

- Check the message __Welcome greeting__ published in the News Bulletin Board.

- Dear student please edit your profile uploading a photo where your face is clearly visible.

- The purpose of the virtual meetings is to answer questions and not to make a summary of the study material.

- This presentation is based on [@cardenas_introduccion_2020, Chapter 8]

# Purpose

Analyze the functioning of the financial market, identifying the types of intermediaries and instruments that are part of it

# Structure of the Colombian financial system

- The financial system is the set of entities whose main function is to channel the money of savers to those who wish to make investments 

    + We are only going to focus on supervised financial entities. Therefore entities outside the law or unregulated are not going to be analyzed
    
    + Also ponzi schemes, pyramids or unregulated investment scheme are not analyzed. 
    
        + However if you are interested in this topic check out [@carvajal_ponzi_2009]  and [@hofstetter_ponzi_2018]

# Structure of the Colombian financial system

- By supervised entities [@congreso_de_colombia_decreto_1993]

```{r out.width="160%"}
grViz("
digraph boxes_and_circles {

  graph [rankdir = LR]

  node [shape = circle, color = '#2C3E50']
 
  'Sector Financiero';

  node [shape = oval, color = '#E31A1C']

  'Establecimientos\nde crédito';
  'Sociedades de\nservicios financieros';
  'Sociedades de\nCapitalización';
  'Entidades Aseguradores\ne Intermediarios';
  
  node [shape = oval, color = '#18BC9C']
  
  'Establecimientos bancarios';
  'Corporaciones Financieras';
  'Compañías de Financiamiento';
  'Cooperativas Financieras';
  'Sociedades fiduciarias';
  'Almacenes generales de depósito';
  'Sociedades administradoras de\nFondos de Pensiones y de Cesantías';
  'Entidades aseguradoras';
  'Intermediarios de seguros';
  'Intermediarios de reaseguros';
  
  'Sector Financiero' -> 'Establecimientos\nde crédito';
  'Sector Financiero' -> 'Sociedades de\nservicios financieros';
  'Sector Financiero' -> 'Sociedades de\nCapitalización';
  'Sector Financiero' -> 'Entidades Aseguradores\ne Intermediarios';
  
  'Establecimientos\nde crédito' -> 'Establecimientos bancarios';
  'Establecimientos\nde crédito' -> 'Corporaciones Financieras';
  'Establecimientos\nde crédito' -> 'Compañías de Financiamiento';
  'Establecimientos\nde crédito' -> 'Cooperativas Financieras';
  'Sociedades de\nservicios financieros' -> 'Sociedades fiduciarias';
  'Sociedades de\nservicios financieros' -> 'Almacenes generales de depósito';
  'Sociedades de\nservicios financieros' -> 'Sociedades administradoras de\nFondos de Pensiones y de Cesantías';
  'Entidades Aseguradores\ne Intermediarios' -> 'Entidades aseguradoras';
  'Entidades Aseguradores\ne Intermediarios' -> 'Intermediarios de seguros';
  'Entidades Aseguradores\ne Intermediarios' -> 'Intermediarios de reaseguros';
}
")
```

# Structure of the Colombian financial system

- By markets [@cardenas_santamaria_introduccion_2013, Chapter 8, p 321]

```{r out.width="160%"}
grViz("
digraph boxes_and_circles {

  graph [rankdir = LR]

  node [shape = circle, color = '#2C3E50']
 
  'Sector Financiero';

  node [shape = oval, color = '#E31A1C']

  'Mercado monetario';
  'Mercado de capitales';
  'Mercado de divisas';
  'Otros mercados financieros';
  
  node [shape = oval, color = '#18BC9C']
  
  'Bancario';
  'No bancario';
  
  node [shape = oval, color = '#CCBE93']
  
  'Bancos';
  'Otros intermediarios';
  'Acciones';
  'Renta fija';
  'Derivados';
  'Otros mercados';
  
  'Sector Financiero' -> 'Mercado monetario';
  'Sector Financiero' -> 'Otros mercados financieros';
  'Sector Financiero' -> 'Mercado de divisas';
  'Sector Financiero' -> 'Mercado de capitales';
  
  'Mercado de capitales' -> 'Bancario';
  'Mercado de capitales' -> 'No bancario';
  
  'Bancario' -> 'Bancos';
  'Bancario' -> 'Otros intermediarios';
  'No bancario' -> 'Acciones';
  'No bancario' -> 'Renta fija';
  'No bancario' -> 'Derivados';
  'No bancario' -> 'Otros mercados';
}
")
```

# Financial depth

- "Financial depth captures the financial sector relative to the economy. It is the size of banks, other financial institutions, and financial markets in a country, taken together and compared to a measure of economic output" [@world_bank_financial_2016]

- How it is measure using quantity indicators?[^1]

    + **Domestic credit to private sector (% of GDP)**
    + **Market capitalization of listed domestic companies (% of GDP)**
    
        + Share price times the number of shares outstanding (including their several classes) for listed domestic companies
    
- According to the literature the "evidence suggests that both financial intermediaries and markets matter for growth and that reverse causality alone is not driving this relationship" [@levine_chapter_2005, p 866]


[^1]: These indicators doesn't measure the quality of financial depth 

# Financial depth

```{r out.width="90%"}
start_date <- 2020
end_date <- 2020

credit_private <- wbstats::wb_data(country = "countries_only",
                               # Domestic credit to private sector (% of GDP)
                               ## FS.AST.PRVT.GD.ZS
                               #  GDP per capita, PPP (constant 2017 international $)
                               ## NY.GDP.PCAP.PP.KD
                               indicator    = c("FS.AST.PRVT.GD.ZS", "NY.GDP.PCAP.PP.KD"),
                               start_date = start_date,
                               end_date = end_date,
                               return_wide  = TRUE) %>%
  filter(!is.na(FS.AST.PRVT.GD.ZS), !is.na(NY.GDP.PCAP.PP.KD)) %>%
  select(iso3c, country, date,
         FS.AST.PRVT.GD.ZS, NY.GDP.PCAP.PP.KD)

credit_private %>%
  ggplot(aes(x = FS.AST.PRVT.GD.ZS,
             y = NY.GDP.PCAP.PP.KD)) +
  geom_point(color = "black",
             fill = unname(palette_light()[2]),
             shape = 21,
             show.legend = FALSE) +
  geom_label_repel(data = filter(credit_private, iso3c %in% c("COL", "MAC")),
                   aes(label = country),
                   seed = 1234,
                   size = 3,
                   min.segment.length = 0,
                   box.padding = 1,
                   force = 2,
                   max.overlaps = Inf) +
  scale_x_log10() +
  scale_y_log10(labels = scales::number_format()) +
  labs(x        = "Domestic credit to private sector (% of GDP)",
       y        = str_glue("GDP per capita, PPP
                           (constant 2017 international $)"),
       color = NULL,
       title    = "Financial depth vs Gross Domestic Product per-capita",
       subtitle = str_glue("Period: {start_date}
                           Axis scales: Logarithmic Base 10
                           Number of territories: {nrow(credit_private)}"),
       caption  = str_glue("Source: World Development Indicators (WDI) - World Bank
                             Last update date: 2022-12-22")) +
  theme(panel.border      = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```


# Financial depth

```{r out.width="90%"}
start_date <- 2020
end_date <- 2020

market_cap <- wbstats::wb_data(country = "countries_only",
                 # Market capitalization of listed domestic companies (% of GDP)
                 ## CM.MKT.LCAP.GD.ZS
                 #  GDP per capita, PPP (constant 2017 international $)
                 ## NY.GDP.PCAP.PP.KD
                 indicator    = c("CM.MKT.LCAP.GD.ZS", "NY.GDP.PCAP.PP.KD"),
                 start_date = start_date,
                 end_date = end_date,
                 return_wide  = TRUE) %>%
  filter(!is.na(CM.MKT.LCAP.GD.ZS), !is.na(NY.GDP.PCAP.PP.KD)) %>%
  select(iso3c, country, date,
         CM.MKT.LCAP.GD.ZS, NY.GDP.PCAP.PP.KD)

market_cap %>%
  ggplot(aes(x = CM.MKT.LCAP.GD.ZS,
             y = NY.GDP.PCAP.PP.KD)) +
  geom_point(color = "black",
             fill = unname(palette_light()[2]),
             shape = 21,
             show.legend = FALSE) +
  geom_label_repel(data = filter(market_cap, iso3c %in% c("COL", "HKG")),
                   aes(label = country),
                   seed = 1234,
                   size = 3,
                   min.segment.length = 0,
                   box.padding = 1,
                   force = 2,
                   max.overlaps = Inf) +
  scale_x_log10() +
  scale_y_log10(labels = scales::number_format()) +
  labs(x        = "Market capitalization of listed domestic companies (% of GDP)",
       y        = str_glue("GDP per capita, PPP
                           (constant 2017 international $)"),
       color = NULL,
       title    = "Financial depth vs Gross Domestic Product per-capita",
       subtitle = str_glue("Period: {start_date}
                           Axis scales: Logarithmic Base 10
                           Number of territories: {nrow(market_cap)}"),
       caption  = str_glue("Source: World Development Indicators (WDI) - World Bank
                             Last update date: 2022-12-22")) +
  theme(panel.border      = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Uncertainty in financial markets

- Financing is essentially the exchange of a sum of money today for a promise to return more money in the future. Therefore it is not surprising that such exchange can be problematic [@cardenas_santamaria_introduccion_2013, p 325]

    + **Information asymmetry**: in an exchange one party has more or better information than the other

        + **Adverse selection**
        + **Moral hazard**
        
# Uncertainty in financial markets

- **Adverse selection** occurs when it is not possible to identify the quality of a product for a party that participates in a transaction. Therefore bad products are sold with good products where the consequence is that bad products take off good products from the market [@durlauf_adverse_1987]

    + In the context of financial markets **adverse selection** occurs when an increase in interest rates induces good debtors to stop requesting loans, so that only those individuals with a higher probability of not paying the loan end up requesting loans [@cardenas_santamaria_introduccion_2013, p 327]
    
# Uncertainty in financial markets

- **Moral hazard** is "any situation in which one person makes the decision about how much risk to take, while someone else bears the cost if things go badly" [@krugman_return_2009, p 63]

    + In the context of financial markets **moral hazard** occurs when debtors take riskier actions that increase the probability of default [@cardenas_santamaria_introduccion_2013, p 328]
    
# Principal instruments "Mercado no intermediado"

- **Fixed income (Renta fija)**: provides returns in the form of regular interest payments and repayments of the principal

    + Títulos de tesorería (TES)
    
        + Debt securities issued by the national government and administered by the Banco de la República. 
        
        + The national government use this instrument to finance its activities
        
    + Certificados de Depósito a Término (CDT)
    
# Principal instruments "Mercado no intermediado"

```{r out.width="90%"}
# Data
# https://www.banrep.gov.co/es > Estadísticas Económicas
# > Tasas de interés y sector financiero > 2. Otras tasas de interés # > TES > Tasa cero cupón pesos
tes_daily_t_10 <- read_csv(file = "000_data/008_tasa_cero_cupon_pesos.csv", 
                           locale = locale(decimal_mark = ",")) %>% 
  select(1, 3:4, 7, 11) %>%
  set_names(nm = c("date", "description", "id", "t_10", "periodicity")) %>% 
  filter(id == 14, periodicity == "Diario")

tes_daily_t_10 %>%
  ggplot(aes(x = date,
             y = t_10)) +
  geom_line(color = unname(palette_light()[1]),
             show.legend = FALSE) +
  scale_y_continuous(labels = scales::number_format(suffix = "%", 
                                                    accuracy = 1)) +
  labs(x        = NULL,
       y        = "Percent",
       color = NULL,
       title    = "Interest rates: TES zero coupon - 10 years",
       subtitle = str_glue("Periodicity: Daily"),
       caption  = str_glue("Source: Banco de la Republica
                             Last update date: 2022-01-10")) +
  theme(panel.border      = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Principal instruments "Mercado no intermediado"

- **Equity (Renta variable)**:

    + Shares/Stocks
    
        + These instruments are issued by companies to raise funds from the general public
        
        + They represent a fractional ownership in the company that issue them

# Principal instruments "Mercado no intermediado"       
        
```{r out.width="90%"}

# https://www.banrep.gov.co/es > Estadísticas económicas > Tasas de interés y sector financiero
# 5. Mercado accionario > Mercado accionario > DESCARGAR Y CONSULTAR > Serie histórica diaria
msci_colcap <- read_excel(path = "000_data/008_imbc_colcap_iqy.xlsx", 
                          sheet = 1, 
                          range = "A8:B3665") %>%
  set_names(nm = c("date", "value")) %>%
  mutate(date = ymd(date))

msci_colcap %>%
  ggplot(aes(x = date,
             y = value)) +
  geom_line(color = unname(palette_light()[1]),
             show.legend = FALSE) +
  labs(x        = NULL,
       y        = NULL,
       color = NULL,
       title    = "MSCI COLCAP Index",
       subtitle = str_glue("Periodicity: Daily"),
       caption  = str_glue("Source: Bolsa de Valores de Colombia (BVC)
                             Last update date: 2023-10-01")) +
  theme(panel.border      = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Banking market or "Mercado Intermediado" 

- **What is a bank?**

  + "A bank is an institution **whose current operations** consist in granting loans and receiving deposits from the public" [@freixas_microeconomics_2008, p 1]
  
      + Therefore the core activities of banks are related to deposits and loans
      
- **What functions banks perform?**¨ [@freixas_microeconomics_2008, p 2]

    + Offering liquidity and payment services
    + Transforming assets
    + Managing risks
    + Processing information and monitoring borrowers
    
# Banking market or "Mercado Intermediado"

- **Offering liquidity and payment services** [@freixas_microeconomics_2008, p 2-4]

    + Banks offer short term credits to companies and individuals and have created networks that facilitate the transfer of funds between the bank accounts of economic agents
    
- **Transforming assets** [@freixas_microeconomics_2008, p 5-6]

    + **Convenience of denomination**: banks collect small deposits to offer large loans
    + **Quality transformation**: bank deposits offer better risk-return characteristics than direct investments
    + **Maturity transformation**: banks transform securities with short maturities, offered to depositors, into securities with long maturities, which borrowers desire
    
# Banking market or "Mercado Intermediado"

- **Managing risks**: 

    + **Credit risk**: it is related to the the probability that a loan is no repaid
    + **Interest rate risk**: it is related to the difference between deposit rates, which change more, and lending rates, which are more stable
    + **Liquidity risk**: it is related to the difficulty a bank has in selling a loan compared to the ease with which a depositor withdraws his savings
    
- In the case of the Colombian context the framework to manage risks is known as **Sistema Integral de Administración de Riesgos (SIAR)** [@superintendencia_financiera_de_colombia_circular_2021, chapter 31]

# Banking market or "Mercado Intermediado"

```{r}
# https://www.superfinanciera.gov.co > INDUSTRIAS SUPERVISADAS > 
# Entidades vigilidas por la superintendencia financiera de Colombia # > Lista general de entidades vigilidas por la superintendencia financiera de Colombia > Descargue el archivo en formato Excel
bank_table <- read_excel("000_data/008_entidades_vigiladas_superintendencia_financiera_colombia2.xls",
                         sheet = 1, 
                         range = "B15:P445") %>% 
  slice(-1) %>% 
  select(1:2,5:6) %>% 
  set_names(nm = c("Type", "Code", "Abbreviate Name", "NIT")) %>% 
  filter(Type == 1)

cut <- round(nrow(bank_table) / 2)

bank_table %>%
  slice(1:cut) %>% 
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 2, linesep = "", caption = "Supervised banking establishments") %>%
  kable_styling(font_size = 7) %>%
  row_spec(row = 0, bold = TRUE) %>% 
  footnote(general       = c('Source: Superintendencia Financiera de Colombia', 'Last update: 2023-01-10'),
           general_title = "",
           threeparttable = TRUE)
```

# Banking market or "Mercado Intermediado"

```{r}
bank_table %>%
  slice(cut:nrow(bank_table)) %>% 
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 2, linesep = "", caption = "Supervised banking establishments") %>%
  kable_styling(font_size = 7) %>%  
  row_spec(row = 0, bold = TRUE) %>% 
  footnote(general       = c('Source: Superintendencia Financiera de Colombia', 'Last update: 2023-01-10'),
           general_title = "",
           threeparttable = TRUE)
```

# Banking market or "Mercado Intermediado"

```{r out.width="90%"}
i_rate_deposit_lending <- wbstats::wb_data(country = "COL",
                                   # Deposit interest rate (%)
                                   ## FR.INR.DPST
                                   # Lending interest rate (%)
                                   ## FR.INR.LEND
                                   indicator    = c("FR.INR.DPST", "FR.INR.LEND"),
                                   return_wide  = FALSE) %>%
  filter(!is.na(value))

i_rate_deposit_lending %>% 
  ggplot(aes(x = date,
             y = value)) +
  geom_line(aes(color = indicator)) +
  scale_y_continuous(labels = scales::number_format(suffix = "%")) +
  scale_color_tq() +
  labs(x = NULL,
       y = NULL,
       color = NULL,
       title = "Deposit and lending interest rate in Colombia",
       subtitle = str_glue("Period: {min(i_rate_deposit_lending$date)}-{max(i_rate_deposit_lending$date)}"),
       caption = str_glue("Source: World Development Indicators (WDI) - World Bank
                          Last update: 2022-12-22")) +
  theme(panel.border    = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Acknowledgments

- To my family that supports me

- To the taxpayers of Colombia and the __[UMNG students](https://www.umng.edu.co/estudiante)__ who pay my salary

- To the __[Business Science](https://www.business-science.io/)__ and __[R4DS Online Learning](https://www.rfordatasci.com/)__ communities where I learn __[R](https://www.r-project.org/about.html)__ 

- To the __[R Core Team](https://www.r-project.org/contributors.html)__, the creators of __[RStudio IDE](https://rstudio.com/products/rstudio/)__ and the authors and maintainers of the packages  __[DiagrammeR](https://CRAN.R-project.org/package=DiagrammeR)__, __[tidyverse](https://CRAN.R-project.org/package=tidyverse)__, __[wbstats](https://CRAN.R-project.org/package=wbstats)__, __[tidyquant](https://CRAN.R-project.org/package=tidyquant)__, __[ggrepel](https://CRAN.R-project.org/package=ggrepel)__, __[lubridate](https://CRAN.R-project.org/package=lubridate)__, __[knitr](https://CRAN.R-project.org/package=knitr)__, __[kableExtra](https://CRAN.R-project.org/package=kableExtra)__, __[readxl](https://CRAN.R-project.org/package=readxl)__, and __[tinytex](https://CRAN.R-project.org/package=tinytex)__ for allowing me to access these tools without paying for a license

- To the __[Linux kernel community](https://www.kernel.org/category/about.html)__ for allowing me the possibility to use some __[Linux distributions](https://static.lwn.net/Distributions/)__ as my main __[OS](https://en.wikipedia.org/wiki/Operating_system)__ without paying for a license

# References {.allowframebreaks}