---
title: "External sector I"
author: Luis Francisco Gomez Lopez
date: 2023-01-10 17:58:12
output:
  beamer_presentation:
    colortheme: dolphin
    fonttheme: structurebold
    theme: AnnArbor
  ioslides_presentation: default
  slidy_presentation: default
bibliography: intro_econ.bib
link-citations: yes
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{xcolor}
  - \usepackage{fontawesome5}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo      = FALSE, 
                      warning   = FALSE, 
                      message   = FALSE,
                      fig.align = "center")
```

```{r}
library(tidyverse)
library(wbstats)
library(tidyquant)
library(readxl)
library(knitr)
library(kableExtra)
library(imfr)
```

# Contents

- Please Read Me
- Purpose
- Trade in Colombia and around the World
- Balance of payments
- Acknowledgments
- References

# Please Read Me

- Check the message __Welcome greeting__ published in the News Bulletin Board.

- Dear student please edit your profile uploading a photo where your face is clearly visible.

- The purpose of the virtual meetings is to answer questions and not to make a summary of the study material.

- This presentation is based on [@cardenas_introduccion_2020, Chapter 5]

# Purpose

Explain the composition and determinants of Colombian foreign trade

# Trade in Colombia and around the World

- Trade is the sum of exports and imports of goods and services measured as a share of gross domestic product in a defined territory

$$Trade_t = \frac{X_t + M_t}{GDP_t} \times 100$$

- We can calculate this metric for a specific country or region and even for the World

- Also it is important so point out that $Trade_t$ can be greater than $100$. Even in some countries we have that $\frac{X_t}{GDP_t} \times 100 \geq 100$ or $\frac{M_t}{GDP_t} \times 100 \geq 100$ 

# Trade in Colombia and around the World

```{r out.width="90%"}
trade_usa_col_world <- wbstats::wb_data(indicator = "NE.TRD.GNFS.ZS",
                                        country = c("COL", "WLD", "USA")) %>%
  filter(between(date, 1970, 2021))

trade_usa_col_world %>%
  ggplot(aes(x = date, y = NE.TRD.GNFS.ZS)) +
  geom_line(aes(color = country, group = country)) +
  scale_color_tq() +
  scale_y_continuous(labels = scales::number_format(suffix = "%")) +
  labs(x = NULL,
       y = NULL,
       color = NULL,
       title = "Trade (% of GDP) for Colombia, USA and the World",
       subtitle = str_glue("Period: {min(trade_usa_col_world$date)}-{max(trade_usa_col_world$date)}"),
       caption = str_glue("Source: World Development Indicators (WDI) - World Bank
                          Last update: 2022-12-22")) +
  theme(panel.border    = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Balance of payments

- The balance of payments is a "statistical statement that summarizes transactions between residents and nonresidents during a period" [@international_monetary_fund_balance_2009, paragraph 2.12]

- It consist of the following accounts:

    + **Current account**

        + Goods and services account
        + Primary income account
        + Secondary income account
        
    + **Capital account**
    
    + **Financial account**
    
- In the case of Colombia you can find the balance of payments in

    + https://www.banrep.gov.co/ > Estadísticas > Tasas de cambio, sector externo y derivados > Sector Externo > Balanza de pagos
    
# Balance of payments

- **Current account**: "shows flows of goods, services, primary income, and secondary income between residents and nonresidents" [@international_monetary_fund_balance_2009, paragraph 2.14]

    + **Goods and services account**: "shows transactions in items that are outcomes of production activities" [@international_monetary_fund_balance_2009, paragraph 10.1]
    
    + **Primary income account**: "captures returns for the provision of labor and financial assets and renting of natural resources" [@international_monetary_fund_balance_2009, paragraph 11.5] between resident and nonresident institutional units
    
    + **Secondary income account**: shows current transfers between residents and nonresidents [@international_monetary_fund_balance_2009, paragraph 12.1]
    
# Balance of payments

```{r}
# Data
# https://www.banrep.gov.co/es > Estadísticas Económicas
# > Sector externo, tasas de cambio y derivados > 1. Sector Externo 
# > Balanza de pagos > Resumen - Anual
bop_col <- read_excel(path = "000_data/005_1_1_1_bp_resumen_iqy2.xlsx", 
                      sheet = 1, 
                      range = "A11:X53") %>% 
  select(1, 21:23) %>% 
  set_names(nm = c("Account", as.character(2019:2021)))

bop_col_current_account_table <- bop_col %>% 
  slice(1:18) %>% 
  mutate(Account = replace(Account, 
                           list = Account == "1.A.b Servicios (*)", 
                           values = "1.A.b Servicios"))

bop_col_current_account_table_footnote <- bop_col_current_account_table


names(bop_col_current_account_table_footnote)[2:3] <-paste0(names(bop_col_current_account_table_footnote)[2:3],
                                                            footnote_marker_alphabet(1, "latex"))

names(bop_col_current_account_table_footnote)[4] <-  paste0(names(bop_col_current_account_table_footnote)[4],
                                                              footnote_marker_alphabet(2, "latex"))

bop_col_current_account_table_footnote %>%
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 0, linesep = "") %>%
  kable_styling(font_size = 6)  %>% 
  add_indent(positions = 10, level_of_indent = 3.5) %>% 
  row_spec(1, bold = TRUE, background = '#e31a1c') %>% 
  row_spec(c(4, 13, 16), bold = TRUE, background = '#18BC9C') %>% 
  row_spec(row = c(7,10), background = '#CCBE93') %>%
  footnote(general       = c('Source: Banco de la República - Colombia', 'Last update: 2022-06-15'),
           general_title = "",
           number = 'Methodology: Sixth version of the Balance of Payments Manual',
           alphabet = c('Revised data (Millions of current USD)', 'Provisional data (Millions of current USD)'), 
           threeparttable = TRUE)
```
    
# Balance of payments

```{r include=FALSE}
# This part is needed because there is a string
# for loading the package
bop_col_2000_2021 <- imf_data(database_id = "BOP",
                              # Current Account
                              indicator = c("BCA_BP6_USD",
                                            # Balance of Goods
                                            "BG_BP6_USD",
                                            # Balance of services
                                            "BS_BP6_USD",
                                            # Balance of Primary Income
                                            "BIP_BP6_USD",
                                            # Balance of Secondary Income
                                            "BIS_BP6_USD"),
                              country = "CO",
                              start = 2000,
                              end = 2021)
```

```{r out.width="90%"}
bop_col_2000_2021_longer <- bop_col_2000_2021 %>%
  as_tibble() %>%
  mutate(year = as.integer(year)) %>%
  pivot_longer(cols = BG_BP6_USD:BIS_BP6_USD,
               names_to = "variables",
               values_to = "values") %>%
  mutate(variables = fct_relevel(variables,
                                 c("BG_BP6_USD",
                                   "BS_BP6_USD",
                                   "BIP_BP6_USD",
                                   "BIS_BP6_USD")))

bop_col_2000_2021_longer %>%
  mutate(variables2 = "BCA_BP6_USD") %>%
  ggplot() +
  geom_col(aes(x = year,
               y = values,
               fill = variables),
           color = "black") +
  geom_line(aes(x = year, y = BCA_BP6_USD,
                color = variables2)) +
  scale_fill_manual(values = unname(palette_light()[1:4]),
                    labels = c("Balance of Goods",
                               "Balance of services",
                               "Balance of Primary Income",
                               "Balance of Secondary Income")) +
  scale_color_manual(values = "#FF7F00",
                     labels = "Current account") +
  guides(fill = guide_legend(nrow = 2, ncol = 2, order = 2),
         color = guide_legend(order = 1)) +
  labs(x = NULL,
       y = NULL,
       fill = NULL,
       color = NULL,
       title = "Current account and its components for Colombia",
       subtitle = str_glue("Variable units: Millions of USD"),
       caption = "Source: International Monetary Fund - Balance of Payments Statistics (BOPS)") +
  theme(panel.border    = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Balance of payments

- **Capital account**

    + The capital account shows credit and debit entries for nonproduced nonfinancial assets and capital transfers between residents and nonresidents [@international_monetary_fund_balance_2009, paragraph 2.16]

    + The Capital account does not appear in the balance of payments of Colombia because the sources of information currently available do not allow the identification and registration of capital transfers

# Balance of payments

- **Financial account**: The financial account records transactions that involve financial assets and liabilities and that take place between residents and nonresidents [@international_monetary_fund_balance_2009, paragraph 8.1]

    + **Direct Investment**: "is a category of cross-border investment associated with a resident in one economy having control or a significant degree of influence on the management of an enterprise that is resident in another economy" [@international_monetary_fund_balance_2009, paragraph 6.8]
    + **Portfolio investment**: "is defined as cross-border transactions and positions involving debt or equity securities, other than those included in direct investment or reserve assets" [@international_monetary_fund_balance_2009, paragraph 6.54]
    
# Balance of payments

- **Financial account**: "records transactions that involve financial assets and liabilities and that take place between residents and nonresidents" [@international_monetary_fund_balance_2009, paragraph 8.1]

    + **Financial Derivatives (Other Than Reserves) and Employee Stock Options**:
    
        + "A financial derivative contract is a financial instrument that is linked to another specific financial instrument or indicator or commodity and through which specific financial risks" ... "can be traded in their own right in financial  markets" [@international_monetary_fund_balance_2009, paragraph 5.80]
        
        + "Employee stock options are options to buy the equity of a company, offered to employees of the company as a form of remuneration" [@international_monetary_fund_balance_2009, paragraph 5.96]

# Balance of payments

- **Financial account**: "records transactions that involve financial assets and liabilities and that take place between residents and nonresidents" [@international_monetary_fund_balance_2009, paragraph 8.1]

    + **Other Investment** [@international_monetary_fund_balance_2009, paragraph 8.42-8.54]
    + **Reserve Assets** [@international_monetary_fund_balance_2009, paragraph 8.55-8.57]

# Balance of payments

```{r}
bop_col_financial_account_table <- bop_col %>% 
  slice(19:41)

names(bop_col_financial_account_table)[2:3] <-  paste0(names(bop_col_financial_account_table)[2:3],
                                                            footnote_marker_alphabet(1, "latex"))

bop_col_financial_account_table_footnote <- bop_col_financial_account_table

names(bop_col_financial_account_table)[4] <-  paste0(names(bop_col_financial_account_table)[4],
                                                              footnote_marker_alphabet(2, "latex"))

bop_col_financial_account_table %>%
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 0, linesep = "") %>%
  kable_styling(font_size = 4.9)  %>%
  row_spec(c(1, 23), bold = TRUE, background = '#e31a1c') %>% 
  row_spec(c(2, 9, 16, 19, 22), bold = TRUE, background = '#18BC9C') %>% 
  row_spec(row = c(3, 6, 10, 13, 17, 18, 20, 21), background = '#CCBE93') %>%
  footnote(general       = c('Source: Banco de la República - Colombia', 'Last update: 2022-06-15'),
           general_title = "",
           number = c('Methodology: Sixth version of the Balance of Payments Manual'),
           alphabet = c('Revised data (Millions of current USD)', 'Provisional data (Millions of current USD)'), 
           threeparttable = TRUE)
```

# Balance of payments

```{r include=FALSE}
# Find the database id
# database_id <- imf_ids()
# database_id %>% 
#  as_tibble() %>% 
# #  filter(database_id == "BOP")

# The iso code is only 2 characters
# Also check out 005_BOP_Introductory_Notes_November_2021.pdf
# > Annex II. Standard Presentation of the Balance of Payments for the variable codes

# imf_data(database_id = "BOP", 
#          indicator = "BCA_BP6_USD", 
#          country = "CO", 
#          start = 2019, 
#          end = 2019)

# This part is needed because there is a string
# for loading the package
bop_col_2000_2021 <- imf_data(database_id = "BOP",
                              # Financial Account
                              indicator = c("BFFR_BP6_USD",
                                            # Direct Investment
                                            "BFD_BP6_USD",
                                            # Portfolio investment
                                            "BFP_BP6_USD",
                                            # Financial Derivatives (Other Than Reserves) and ESOS
                                            "BFF_BP6_USD",
                                            # Other investment
                                            "BFOFR_BP6_USD",
                                            # Reserve Assets
                                            "BFRAFR_BP6_USD"),
                              country = "CO",
                              start = 2000,
                              end = 2021)
```

```{r out.width="90%"}
bop_col_2000_2021_longer <- bop_col_2000_2021 %>%
  as_tibble() %>%
  mutate(year = as.integer(year)) %>%
  pivot_longer(cols = BFD_BP6_USD:BFRAFR_BP6_USD,
               names_to = "variables",
               values_to = "values") %>%
  mutate(variables = fct_relevel(variables,
                                 c("BFD_BP6_USD",
                                   "BFP_BP6_USD",
                                   "BFF_BP6_USD",
                                   "BFOFR_BP6_USD",
                                   "BFRAFR_BP6_USD")))

bop_col_2000_2021_longer %>%
  mutate(variables2 = "BFFR_BP6_USD") %>%
  ggplot() +
  geom_col(aes(x = year,
               y = values,
               fill = variables),
           color = "black") +
  geom_line(aes(x = year, y = BFFR_BP6_USD,
                color = variables2)) +
  scale_fill_manual(values = unname(palette_light()[1:5]),
                    labels = c("Direct Investment",
                               "Portfolio investment",
                               "Financial Derivatives (Other Than Reserves) and ESOS",
                               "Other investment",
                               "Reserve Assets")) +
  scale_color_manual(values = "#FF7F00",
                     labels = "Financial account") +
  guides(fill = guide_legend(nrow = 3, ncol = 2, order = 2),
         color = guide_legend(order = 1)) +
  labs(x = NULL,
       y = NULL,
       fill = NULL,
       color = NULL,
       title = "Financial account and its components for Colombia",
       subtitle = str_glue("Variable units: Millions of USD"),
       caption = "Source: International Monetary Fund - Balance of Payments Statistics (BOPS)") +
  theme(panel.border    = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Balance of payments

- **Net errors and omissions**

    + Financial account - (Current account + Capital account) = Net errors and omissions
    
# Balance of payments

```{r include=FALSE}
# This part is needed because there is a string
# for loading the package
bop_col_2000_2021 <- imf_data(database_id = "BOP",
                              # Net errors and omissions
                              indicator = c("BOPFR_BP6_USD"),
                              country = "CO",
                              start = 2000,
                              end = 2021)
```

```{r out.width="90%"}
bop_col_2000_2021 %>%
  mutate(variables2 = "BOPFR_BP6_USD",
         year = as.integer(year)) %>%
  ggplot() +
  geom_line(aes(x = year, y = BOPFR_BP6_USD,
                color = variables2)) +
  geom_hline(yintercept = 0,
             color = "black") +
  scale_color_manual(values = "#FF7F00",
                     labels = "Net Errors and Omissions") +
  labs(x = NULL,
       y = NULL,
       fill = NULL,
       color = NULL,
       title = "Net Errors and Omissions for Colombia",
       subtitle = str_glue("Variable units: Millions of USD"),
       caption = "Source: International Monetary Fund - Balance of Payments Statistics (BOPS)") +
  theme(panel.border    = element_rect(fill = NA, color = "black"),
        plot.background   = element_rect(fill = "#f3fcfc"),
        panel.background  = element_rect(fill = "#f3f7fc"),
        legend.background = element_rect(fill = "#f3fcfc"),
        legend.position   = "bottom",
        plot.title        = element_text(face = "bold"),
        axis.title        = element_text(face = "bold"),
        legend.title      = element_text(face = "bold"),
        axis.text         = element_text(face = "bold"))
```

# Balance of payments

- **Accounting Framework**

    + **Double-entry bookkeeping** 
    
        + For every transaction between an Colombia resident and the rest of the world, the balance of payments will record two entries [@rba_balance_2021] 
        
    + **Credits** $(+)$
    
        + Outflows of real resources (exports)
        + Decrease in financial assest
        + Increase in liabilities
        
    + **Debits** $(-)$
    
        + Inflows of real resources (imports)
        + Increase in financial assest
        + Decrease in liabilities
        
# Balance of payments

- Examples taken from [@rba_balance_2021] and adapted for Colombia

    1. A Colombian mining company exports $100 million of iron ore to a private Chinese steel maker
    
    2. Colombian residents go on overseas to Panama and spend a total of $5 million. The Colombian residents pay by using money deposited in their Colombian bank accounts

    3. Colombian resident, buys $20 million of shares in a company listed on the New York Stock Exchange, equivalent to less than 10 per cent of the voting rights in that company. The shares are paid for using money from the resident's bank account in Colombia

# Balance of payments 

```{r}
table_bop_example <- tibble("Account" = c("Current account", "Trade balance", "Goods", "Services",
                     "Financial account", "Portfolio investment", "Other investment","", 
                     "Balance of payments"),
       "Credit" = c("100", "100", "100¹", "",
                    "25", "", "5²", "20³",
                    "125"),
       "Debit" = c("-5", "-5", "", "-5²",
                   "-120", "-20³", "-100¹", "",
                   "-125"),
       "Net" = c("95", "95", "100", "-5",
                 "-95", "-20", "-75", "",
                 "0"))

table_bop_example %>% 
  kable(format = "latex", booktabs = TRUE, escape = FALSE, 
        digits = 0, linesep = "") %>%
  kable_styling(font_size = 12) %>%
  add_indent(positions = c(2, 6, 7), level_of_indent = 1) %>%
  add_indent(positions = c(3, 4), level_of_indent = 2) %>%
  row_spec(row = c(0, 1, 5, 9), bold = TRUE) %>% 
  footnote(general       = "*The superscripts indicate the examples' transactions",
           general_title = "", 
           threeparttable = TRUE)
```

# Acknowledgments

- To my family that supports me

- To the taxpayers of Colombia and the __[UMNG students](https://www.umng.edu.co/estudiante)__ who pay my salary

- To the __[Business Science](https://www.business-science.io/)__ and __[R4DS Online Learning](https://www.rfordatasci.com/)__ communities where I learn __[R](https://www.r-project.org/about.html)__ 

- To the __[R Core Team](https://www.r-project.org/contributors.html)__, the creators of __[RStudio IDE](https://rstudio.com/products/rstudio/)__ and the authors and maintainers of the packages  __[tidyverse](https://CRAN.R-project.org/package=tidyverse)__, __[wbstats](https://CRAN.R-project.org/package=wbstats)__, __[tidyquant](https://CRAN.R-project.org/package=tidyquant)__, __[readxl](https://CRAN.R-project.org/package=readxl)__, __[knitr](https://CRAN.R-project.org/package=knitr)__, __[kableExtra](https://CRAN.R-project.org/package=kableExtra)__, __[imfr](https://CRAN.R-project.org/package=imfr)__, and __[tinytex](https://CRAN.R-project.org/package=tinytex)__ for allowing me to access these tools without paying for a license

- To the __[Linux kernel community](https://www.kernel.org/category/about.html)__ for allowing me the possibility to use some __[Linux distributions](https://static.lwn.net/Distributions/)__ as my main __[OS](https://en.wikipedia.org/wiki/Operating_system)__ without paying for a license

# References
